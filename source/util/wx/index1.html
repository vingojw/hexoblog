<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>

  <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
</head>
<body>


  <script>

if (typeof WeixinJSBridge == "undefined"){
   if( document.addEventListener ){
       document.addEventListener('WeixinJSBridgeReady', testWxPay, false);
   }else if (document.attachEvent){
       document.attachEvent('WeixinJSBridgeReady', testWxPay);
       document.attachEvent('onWeixinJSBridgeReady', testWxPay);
   }
}else{
   testWxPay();
}


function testWxPay(){
// {
//   "success": true,
//   "result": "{\"appId\":\"wxa0a50507677f858a\",\"nonceStr\":\"BEA5955B308361A1B07BC55042E25E54\",\"package\":\"prepay_id=wx2015091720473752c4bce4480318866339\",\"paySign\":\"9A30E164FA0ACCCA95819453F5127CE4\",\"signType\":\"MD5\",\"timeStamp\":\"1442494058\"}",
//   "error": null,
//   "unAuthorizedRequest": false
// }

	  // wx.config({
	  //   //"debug"     : "true",
	  //   "appId"     : "wxa0a50507677f858a",
	  //   "nonceStr"  : "DDB30680A691D157187EE1CF9E896D03",
	  //   "package"   : "prepay_id=wx201509172022596b85a80ca40160168429",
	  //   "paySign"   : "AE6157C069115F446F749D4C6272CB70",
	  //   "signType"  : "MD5",
	  //   "timeStamp" : "1442492579",
	  //   "jsApiList" : [
	  //     "chooseWXPay"
	  //   ]
	  // });

	//检测是否支持支付
	wx.checkJsApi({
	    jsApiList: ['chooseWXPay'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
	    success: function(res) {
	      //alert(res.errMsg);
	      alert(res.checkResult.chooseWXPay);
	        // 以键值对的形式返回，可用的api值true，不可用为false
	        // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
	       if(res.checkResult.chooseWXPay){

	          //方式一
	          // wx.chooseWXPay({
	          //     timestamp: Date.now(), // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符
	          //     nonceStr: "DDB30680A691D157187EE1CF9E896D03", // 支付签名随机串，不长于 32 位
	          //     package: "prepay_id=wx201509172022596b85a80ca40160168429", //统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=***）
	          //     signType: "MD5", // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'
	          //     paySign: "AE6157C069115F446F749D4C6272CB70", // 支付签名
	          //     success: function (res) {
	          //         // 支付成功后的回调函数
	          //         alert(1111111);
	          //     }
	          // });

	          //方式二
				WeixinJSBridge.invoke(
				    'getBrandWCPayRequest', {"appId":"wxa0a50507677f858a","nonceStr":"1141938BA2C2B13F5505D7C424EBAE5F","package":"prepay_id=wx20150917211111bf571a07480180838949","paySign":"373390F30B4CF6EF49462B3E9D0DE613","signType":"MD5","timeStamp":"1442495471"}, function (res) {
				    {
				        console.info('res', res);
				        if (res.err_msg == 'get_brand_wcpay_request:ok') {

				            //同步跳转地址
				            //window.location.href = '{3}';
				            alert('支付成功');

				        } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {

				            //window.location.href = '{4}'; //alert('取消支付!');

				        } else if (res.err_msg == 'get_brand_wcpay_request:fail') {

				            UI.alert('支付失败，请重新支付!');
				            //window.location.href = '{5}';

				        } else {

				            UI.alert('错误：' + res.err_msg);

				        }
				        //使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。
				        //因此微信团队建议，当收到ok返回时，向商户后台询问是否收到交易成功的通知，若收到通知，前端展示交易成功的界面；若此时未收到通知，商户后台主动调用查询订单接口，查询订单的当前状态，并反馈给前端展示相应的界面。
				    }
				});
	        } else {
	        	UI.alert('您的微信版本太低，无法支付，请升级版本5.0以上');
	        }
	    }
	});

}






  </script>
</body>
</html>